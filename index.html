<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cartes disponibles</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f6f8; color: #333; margin: 0; }
  header { background: #fff; padding: 20px; text-align: center; font-size: 1.6em; font-weight: bold; border-bottom: 1px solid #ddd; }
  #counter { text-align: center; font-size: 1.1em; margin: 10px 0; font-weight: bold; }
  table { width: 100%; border-collapse: collapse; background: #fff; }
  thead { background: #fafafa; }
  thead th { padding: 12px 10px; font-size: 0.9em; text-align: left; border-bottom: 1px solid #ddd; }
  tbody tr { border-bottom: 1px solid #eee; }
  tbody tr:hover { background: #f9f9f9; }
  tbody td { padding: 10px; font-size: 0.9em; vertical-align: middle; }
  button.demander { background-color: #007bff; color: white; padding: 6px 14px; border: none; cursor: pointer; font-weight: bold; border-radius: 4px; font-size: 0.85em; }
  button.demander:hover { background-color: #0056b3; }
  #message { text-align: center; margin: 15px; color: green; font-weight: bold; }
</style>
</head>
<body>

<header>Cartes disponibles</header>
<div id="counter">Cartes disponibles : 0</div>
<div id="message"></div>

<table>
  <thead>
    <tr>
      <th>BIN</th>
      <th>Banque</th>
      <th>Niveau</th>
      <th>Base</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="cardsTable"></tbody>
</table>

<script>
const cardsUrl = './cards.txt';
let cards = [];

fetch(cardsUrl)
  .then(res => res.text())
  .then(text => {
    // Split par "üí≥ + 1 NEW CARD"
    const rawCards = text.split(/üí≥ \+ 1 NEW CARD/).slice(1);
    cards = rawCards.map(c => c.trim()).filter(c => c.length > 10);
    displayCards(cards);
  })
  .catch(err => console.error('Erreur chargement cards.txt', err));

function extractField(text, regex) {
  const m = text.match(regex);
  return m ? m[1].trim() : '';
}

function displayCards(cards) {
  const table = document.getElementById('cardsTable');
  table.innerHTML = '';
  cards.forEach((rawCard, i) => {
    const bin = extractField(rawCard, /üè∑ Bin : #?(\d+)/i);
    const banque = extractField(rawCard, /Nom de la banque : (.*)/i);
    const niveau = extractField(rawCard, /Niveau : (.*)/i);
    const base = extractField(rawCard, /Base : (.*)/i);

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${bin}</td>
      <td>${banque}</td>
      <td>${niveau}</td>
      <td>${base}</td>
      <td><button class="demander" data-index="${i}">Demander</button></td>
    `;
    table.appendChild(row);
  });
  document.getElementById('counter').innerText = `Cartes disponibles : ${cards.length}`;

  document.querySelectorAll('button.demander').forEach(btn => {
    btn.onclick = () => {
      sendMail();
      showMessage("Merci, votre client mail devrait s'ouvrir. Pensez √† envoyer le mail.");
    };
  });
}

function sendMail() {
  const subject = encodeURIComponent("Demande de carte bancaire");
  const body = encodeURIComponent("Bonjour,\n\nJe souhaite demander une carte bancaire.\n\nMerci.");
  const mailto = `mailto:baranostop28@gmail.com?subject=${subject}&body=${body}`;
  window.location.href = mailto;
}

function showMessage(msg) {
  const messageDiv = document.getElementById('message');
  messageDiv.textContent = msg;
  setTimeout(() => { messageDiv.textContent = ''; }, 8000);
}
</script>

</body>
</html>
